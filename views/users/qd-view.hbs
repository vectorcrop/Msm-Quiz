<style>
    .clear{
        display: none;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<br><br>
<br>
<br>
<center>

    <!-- Modal -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p><strong>Time's Up!</strong> Please submit your answers.</p>
    <button id="modalSubmitBtn">OK</button>
  </div>
</div>
 
    {{#each juniors.[0].questions}}
    <h2>{{this.key}}. {{this.question}}</h2>
   <button  class="btn btn-outline-dark answer a{{this.key}}" data-answer="A" data-key="{{this.key}}">{{this.a}}</button><br>
    <button class="btn btn-outline-dark answer a{{this.key}}" data-answer="B" data-key="{{this.key}}">{{this.b}}</button><br>
    <button class="btn btn-outline-dark answer a{{this.key}}" data-answer="C" data-key="{{this.key}}">{{this.c}}</button><br>
    <button class="btn btn-outline-dark answer a{{this.key}}" data-answer="D" data-key="{{this.key}}">{{this.d}}</button><br>
    
     <button class="btn btn-outline-dark clear b{{this.key}}" data-key="{{this.key}}">clear</button><br>
      
      {{/each}}
      <input id="ssno" value="{{juniors.[0]._id}}" hidden><br>
    <button id="submitBtn" class="btn btn-primary">Submit Answers</button>
    {{!-- <button onclick="hideContent()">emit</button> --}}
</center>



<script>
    let answers = [];

    document.addEventListener('DOMContentLoaded', function() {
        console.log("ready@@@")
        // Get all answer elements
        const answerElements = document.querySelectorAll('.answer');
        answerElements.forEach(function(answerElement) {
            answerElement.addEventListener('click', function() {
                const qKey = this.getAttribute('data-key');
                const slAns = this.getAttribute('data-answer');
                 const clrbtn = document.querySelector('.clear.b' + qKey);
                console.log("answerElements t6his",clrbtn)


                // Disable all answer buttons for the clicked question
                document.querySelectorAll('.a' + qKey).forEach(function(element) {
                 
                    if (element !== answerElement) {
                        element.disabled = true;
                    }
                });

            
                 clrbtn.style.display = 'block';
                this.style.backgroundColor = 'yellow';

                // Push selected answer to the answers array
                answers.push({ qKey: qKey, slAns: slAns });
                this.disabled = true;
            });
        });

        // Add event listener for clear buttons
        const clearButtons = document.querySelectorAll('.clear');
        clearButtons.forEach(function(clearButton) {
            clearButton.addEventListener('click', function() {
                const qKey = this.getAttribute('data-key');

                // Re-enable all answer buttons for the clicked question
                document.querySelectorAll('.a' + qKey).forEach(function(element) {
                    element.disabled = false;
                    element.style.backgroundColor = ''; // Reset background color
                });

                // Remove the answer for this question from the answers array
                answers = answers.filter(function(answer) {
                    return answer.qKey !== qKey;
                });
            });
        });
    });

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.addEventListener('click', function() {
        // Send answers to the server (you can customize this part)
         if (answers.length >= 1 && answers.length <= 5) {
        let ss = document.getElementById('ssno').value;
        let qw = window.location.href.split('/').pop();
       console.log(answers)
      
        fetch(`/qd-view/${ss}/${qw}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ answers: answers, qw: qw })
        })
        .then(response => response.json())
        .then(function(response) {
            console.log('Server response:', response);
            answers = [];
            // Check if the server response contains the new URL
            if (response && response.redirectUrl) {
                window.location.href = response.redirectUrl;
            } else {
                console.error('Server response does not contain a redirect URL.');
            }
        })
        .catch(function(error) {
            console.error('Error:', error);
        });
         }else{
            alert("Please select at least 1 answers ")
         }
    });
</script>
<script>
    const socket = io();
    const modal = document.getElementById("myModal");
   // const submitBtn = document.getElementById("submitBtn");

     socket.on('hide', () => {
            console.log(' socket.on hiideeeeeennnnnnnn')
             modal.style.display = "block";
        });
           
    // When the user clicks the OK button in the modal, submit the form
    const modalSubmitBtn = document.getElementById("modalSubmitBtn");
    modalSubmitBtn.onclick = function() {
        if(answers.length==0){
                answers.push({qKey: '1', slAns: ''})
                 console.log(answers)
        }
        submitBtn.click();
    }
</script>

